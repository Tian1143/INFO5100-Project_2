<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 2</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>
    <style>
    .country {
      fill: lightgrey;
    }
    </style>
</head>
<body>
    <svg id="worldMap" height="800" width="1000"></svg>
    <svg id="lineGraph" height="1000" width="1000"></svg>
    <script>
        // World Map
        const svgMap = d3.select("#worldMap");
        const widthMap = svgMap.attr("width");
        const heightMap = svgMap.attr("height");
        const marginMap = { top: 20, right: 20, bottom: 20, left:20};
        const mapWidth = widthMap - marginMap.left - marginMap.right;
        const mapHeight = heightMap - marginMap.top - marginMap.bottom;
        const map = svgMap.append("g")
                        .attr("transform","translate("+marginMap.left+","+marginMap.top+")");
        // World Map code
        const mapData = async function() {
        const world = await d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json");
        console.log("worldJson",world);

            var countries = topojson.feature(world,world.objects.countries);
            console.log("Countries:", countries);
            var countriesMesh = topojson.mesh(world,world.objects.countries); 
            console.log("CountriesMesh:", countriesMesh);
            var projection = d3.geoMercator().fitSize([mapWidth, mapHeight], countries);
            var path = d3.geoPath().projection(projection);

            let graticule = d3.geoGraticule10();
                console.log(graticule);
                map.append("path").attr("class","graticule").attr("d", path(graticule));

            let countryPaths = map.selectAll("path.country").data(countries.features)
                       .join("path")
                       .attr("class", "country")
                       .attr("note", d => d.id)  
                       .attr("d", path);
                       //.on('mouseover',  mouseEntersState )
                       //.on('mouseout',  mouseLeavesState );
    
            map.append("path").datum(countriesMesh)
                .attr("fill", "none")
                .attr("d", path)
                .attr("stroke", "black")
                .attr("stroke-width", 1);

        const olympicsData = await d3.csv("olympics.csv", d3.autoType);
        console.log("olympicsData",olympicsData);
            var countryDict = {}
            olympicsData.forEach( d => {
                countryDict[d.country] = d;
            });
            console.log(countryDict);


        }
        mapData();
        // Line Graph
        const svgGraph = d3.select("#lineGraph");
        const widthGraph = +svgGraph.attr("width");
        const heightGraph = +svgGraph.attr("height");
        const marginGraph = { top: 20, right: 20, bottom: 20, left: 20 };
        const graphWidth = widthGraph - marginGraph.left - marginGraph.right;
        const graphHeight = heightGraph - marginGraph.top - marginGraph.bottom;
        const graph = svgGraph.append("g")
                            .attr("transform", "translate(" + marginGraph.left + "," + marginGraph.top + ")");
        // Line Graph code

    </script>
</body>
</html>